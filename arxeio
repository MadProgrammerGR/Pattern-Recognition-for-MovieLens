COPY u_data FROM 'C:\Users\sotiris dim\Desktop\Programming\Ergasies\Pattern Recognition\ml-100k\u.data' WITH (DELIMITER '	');
COPY u_user FROM 'C:\Users\sotiris dim\Desktop\Programming\Ergasies\Pattern Recognition\ml-100k\u.user' WITH (DELIMITER '|');
COPY u_item FROM 'C:\Users\sotiris dim\Desktop\Programming\Ergasies\Pattern Recognition\ml-100k\u.item' WITH (DELIMITER '|');

Copy ( 
    SELECT ud.user_id, gender, age,
        sum((rating-3)*unknown) as unknown, sum((rating-3)*action) as action, sum((rating-3)*adventure) as adventure,sum((rating-3)*animation) as animation,
        sum((rating-3)*childrens) as childrens, sum((rating-3)*crime) as crime, sum((rating-3)*documentary) as documentary, sum((rating-3)*drama) as drama, 
        sum((rating-3)*fantasy) as fantasy, sum((rating-3)*filmnoir) as filmnoir, sum((rating-3)*horror) as horror, sum((rating-3)*musical)as musical, 
        sum((rating-3)*mystery) as mystery, sum((rating-3)*romance) as romance, sum((rating-3)*scifi) as scifi, sum((rating-3)*thriller) as thriller,
        sum((rating-3)*war) as war, sum((rating-3)*western) as western
    FROM u_data as ud inner join u_user as uu on ud.user_id = uu.user_id
        inner join u_item as ui on ud.item_id = ui.movie_id
    GROUP BY ud.user_id, gender, age
) To 'C:\Users\sotiris dim\Desktop\test.csv' With (format CSV, DELIMITER ',', header);
